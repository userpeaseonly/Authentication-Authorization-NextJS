{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/dragonfire/Desktop/NextJS/authproject/client/src/tanstack/api.tsx"],"sourcesContent":["import { UserCred } from \"@/types\";\nimport axios, { AxiosInstance } from \"axios\";\n\nconst BASE_URL = \"http://localhost:3001\";\n\nconst loginInstance = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n});\n\nexport const verifyTokenInstance = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n});\n\n\nexport const login = async (userCred: UserCred) => {\n  const res = await loginInstance.post(\"/login\", userCred, {\n    withCredentials: true,\n  });\n  return res;\n};\n\nexport const refreshTokenInstaance = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n});\n\nexport const verifyToken = async (verTokenIns: AxiosInstance) => {\n  try {\n    const res = await verTokenIns.get(\"/verify\");\n    console.log(res);  \n    return res;\n  } catch (e) {\n    const err = e as {status: number};\n    const statusCode = err.status\n    return statusCode;\n  }\n};\n\n"],"names":[],"mappings":";;;;;;AACA;;AAEA,MAAM,WAAW;AAEjB,MAAM,gBAAgB,wIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IACjC,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEO,MAAM,sBAAsB,wIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IAC9C,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAGO,MAAM,QAAQ,OAAO;IAC1B,MAAM,MAAM,MAAM,cAAc,IAAI,CAAC,UAAU,UAAU;QACvD,iBAAiB;IACnB;IACA,OAAO;AACT;AAEO,MAAM,wBAAwB,wIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IAChD,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEO,MAAM,cAAc,OAAO;IAChC,IAAI;QACF,MAAM,MAAM,MAAM,YAAY,GAAG,CAAC;QAClC,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT,EAAE,OAAO,GAAG;QACV,MAAM,MAAM;QACZ,MAAM,aAAa,IAAI,MAAM;QAC7B,OAAO;IACT;AACF"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///home/dragonfire/Desktop/NextJS/authproject/client/src/hooks/useRefresh.tsx"],"sourcesContent":["import { refreshTokenInstaance } from \"@/tanstack/api\"\nimport { saveToken } from \"@/toolkit/userSlice\";\nimport { useDispatch } from \"react-redux\";\n\nexport const useRefresh = () => {\n    const dispatch = useDispatch();\n    const refresh = async () => {\n        const res = await refreshTokenInstaance(\"/refresh\", {withCredentials: true});\n        const newAccessToken = res.data.accessToken;\n        dispatch(saveToken(newAccessToken));\n        console.log(res);\n    }\n    return refresh;\n}"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;;AAEO,MAAM,aAAa;;IACtB,MAAM,WAAW,CAAA,GAAA,4JAAA,CAAA,cAAW,AAAD;IAC3B,MAAM,UAAU;QACZ,MAAM,MAAM,MAAM,CAAA,GAAA,0HAAA,CAAA,wBAAqB,AAAD,EAAE,YAAY;YAAC,iBAAiB;QAAI;QAC1E,MAAM,iBAAiB,IAAI,IAAI,CAAC,WAAW;QAC3C,SAAS,CAAA,GAAA,+HAAA,CAAA,YAAS,AAAD,EAAE;QACnB,QAAQ,GAAG,CAAC;IAChB;IACA,OAAO;AACX;GATa;;QACQ,4JAAA,CAAA,cAAW"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///home/dragonfire/Desktop/NextJS/authproject/client/src/hooks/useInterceptor.tsx"],"sourcesContent":["import { verifyTokenInstance } from \"@/tanstack/api\";\nimport { RootState } from \"@/toolkit/store\";\nimport { useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useRefresh } from \"./useRefresh\";\n\nexport default function useInterceptor() {\n    const refresh = useRefresh();\n    const accessToken = useSelector((state: RootState) => state.userSlice.accessToken);\n\n    useEffect(() => {\n        const regInterceptor = verifyTokenInstance.interceptors.request.use((config) => {\n            console.log(\"Request Interceptor\", config);\n            if(!config.headers.Authorization){\n                config.headers.Authorization = `Bearer ${accessToken}`;\n            }\n            return config;\n        });\n\n\n        const resInterceptor = verifyTokenInstance.interceptors.response.use((res) => {\n            console.log(\"Response Interceptor\", res);\n            \n            return res;\n        }, async (error) => {\n            const initialReq = error.config;\n            console.log(\"Response Interceptor\", error);\n            if(error.status === 401){\n                const { newAccessToken } = await refresh();\n                initialReq.headers.Authorization = `Bearer ${newAccessToken}`;\n                return verifyTokenInstance(initialReq);\n            }\n            return Promise.reject(error);\n        });\n\n        return () => {\n            verifyTokenInstance.interceptors.request.eject(regInterceptor);\n            verifyTokenInstance.interceptors.response.eject(resInterceptor);\n        }\n    }, []);\n\n    return {verifyTokenInstance};\n}"],"names":[],"mappings":";;;AAAA;AAEA;AAEA;AADA;;;;;;AAGe,SAAS;;IACpB,MAAM,UAAU,CAAA,GAAA,8HAAA,CAAA,aAAU,AAAD;IACzB,MAAM,cAAc,CAAA,GAAA,4JAAA,CAAA,cAAW,AAAD;mDAAE,CAAC,QAAqB,MAAM,SAAS,CAAC,WAAW;;IAEjF,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;oCAAE;YACN,MAAM,iBAAiB,0HAAA,CAAA,sBAAmB,CAAC,YAAY,CAAC,OAAO,CAAC,GAAG;gEAAC,CAAC;oBACjE,QAAQ,GAAG,CAAC,uBAAuB;oBACnC,IAAG,CAAC,OAAO,OAAO,CAAC,aAAa,EAAC;wBAC7B,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,aAAa;oBAC1D;oBACA,OAAO;gBACX;;YAGA,MAAM,iBAAiB,0HAAA,CAAA,sBAAmB,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG;gEAAC,CAAC;oBAClE,QAAQ,GAAG,CAAC,wBAAwB;oBAEpC,OAAO;gBACX;;gEAAG,OAAO;oBACN,MAAM,aAAa,MAAM,MAAM;oBAC/B,QAAQ,GAAG,CAAC,wBAAwB;oBACpC,IAAG,MAAM,MAAM,KAAK,KAAI;wBACpB,MAAM,EAAE,cAAc,EAAE,GAAG,MAAM;wBACjC,WAAW,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,gBAAgB;wBAC7D,OAAO,CAAA,GAAA,0HAAA,CAAA,sBAAmB,AAAD,EAAE;oBAC/B;oBACA,OAAO,QAAQ,MAAM,CAAC;gBAC1B;;YAEA;4CAAO;oBACH,0HAAA,CAAA,sBAAmB,CAAC,YAAY,CAAC,OAAO,CAAC,KAAK,CAAC;oBAC/C,0HAAA,CAAA,sBAAmB,CAAC,YAAY,CAAC,QAAQ,CAAC,KAAK,CAAC;gBACpD;;QACJ;mCAAG,EAAE;IAEL,OAAO;QAAC,qBAAA,0HAAA,CAAA,sBAAmB;IAAA;AAC/B;GApCwB;;QACJ,8HAAA,CAAA,aAAU;QACN,4JAAA,CAAA,cAAW"}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///home/dragonfire/Desktop/NextJS/authproject/client/src/tanstack/queries.tsx"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\"\nimport { verifyToken } from \"./api\";\nimport useInterceptor from \"@/hooks/useInterceptor\";\n\n\nexport const useVerifyToken = () => {\n    const {verifyTokenInstance} = useInterceptor();\n    const {data, isLoading} = useQuery({\n        queryKey: ['token'],\n        queryFn: () => verifyToken(verifyTokenInstance),\n    });\n    return {data, isLoading};\n}"],"names":[],"mappings":";;;AACA;AACA;AAFA;;;;;AAKO,MAAM,iBAAiB;;IAC1B,MAAM,EAAC,mBAAmB,EAAC,GAAG,CAAA,GAAA,kIAAA,CAAA,UAAc,AAAD;IAC3C,MAAM,EAAC,IAAI,EAAE,SAAS,EAAC,GAAG,CAAA,GAAA,8KAAA,CAAA,WAAQ,AAAD,EAAE;QAC/B,UAAU;YAAC;SAAQ;QACnB,OAAO;uCAAE,IAAM,CAAA,GAAA,0HAAA,CAAA,cAAW,AAAD,EAAE;;IAC/B;IACA,OAAO;QAAC;QAAM;IAAS;AAC3B;GAPa;;QACqB,kIAAA,CAAA,UAAc;QAClB,8KAAA,CAAA,WAAQ"}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///home/dragonfire/Desktop/NextJS/authproject/client/src/app/profile/page.tsx"],"sourcesContent":["\"use client\";\nimport { useVerifyToken } from \"@/tanstack/queries\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect } from \"react\";\n\nexport default function ProfilePage() {\n    const router = useRouter();\n    const { data, isLoading } = useVerifyToken();\n\n    useEffect(() => {\n        if (data === 401) {\n            router.push(\"/\");\n        }\n    }, [data, router]);\n\n    if (isLoading) return <p>Loading...</p>;\n\n    return (\n        <div>\n            <h1>Profile</h1>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;AAHA;;;;AAKe,SAAS;;IACpB,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,8HAAA,CAAA,iBAAc,AAAD;IAEzC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;iCAAE;YACN,IAAI,SAAS,KAAK;gBACd,OAAO,IAAI,CAAC;YAChB;QACJ;gCAAG;QAAC;QAAM;KAAO;IAEjB,IAAI,WAAW,qBAAO,6LAAC;kBAAE;;;;;;IAEzB,qBACI,6LAAC;kBACG,cAAA,6LAAC;sBAAG;;;;;;;;;;;AAGhB;GAjBwB;;QACL,qIAAA,CAAA,YAAS;QACI,8HAAA,CAAA,iBAAc;;;KAFtB"}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}